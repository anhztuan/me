<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'; style-src 'self' https://cdn.jsdelivr.net; font-src 'self'; connect-src 'self'; img-src 'self'; frame-src 'self';">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
    <title>Admin Login - API Endpoint Manager</title>
    <!-- DaisyUI and Tailwind CSS via CDN -->
    <link href="https://cdn.jsdelivr.net/npm/daisyui@3.9.4/dist/full.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: all 0.3s ease;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f8f9fa;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .login-container {
            width: 100%;
            max-width: 400px;
            padding: 2rem;
            background-color: white;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08);
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .login-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .login-header h1 {
            font-size: 1.75rem;
            font-weight: 600;
            color: #805ad5;
            margin-bottom: 0.5rem;
        }

        .login-header p {
            color: #6c757d;
            font-size: 0.9rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .form-group input {
            display: block;
            width: 100%;
            padding: 0.75rem;
            font-size: 1rem;
            line-height: 1.5;
            color: #495057;
            background-color: #fff;
            background-clip: padding-box;
            border: 1px solid #ced4da;
            border-radius: 0.5rem;
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }

        .form-group input:focus {
            color: #495057;
            background-color: #fff;
            border-color: #a3bffa;
            outline: 0;
            box-shadow: 0 0 0 0.2rem rgba(128, 90, 213, 0.25);
        }

        .btn {
            display: inline-block;
            font-weight: 500;
            text-align: center;
            white-space: nowrap;
            vertical-align: middle;
            user-select: none;
            border: 1px solid transparent;
            padding: 0.75rem 1rem;
            font-size: 1rem;
            line-height: 1.5;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: color 0.15s ease-in-out, background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out, transform 0.3s ease;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .btn-primary {
            color: #fff;
            background-color: #805ad5;
            border-color: #805ad5;
        }

        .btn-primary:hover {
            background-color: #6b46c1;
            border-color: #6b46c1;
        }

        .back-link {
            display: block;
            text-align: center;
            margin-top: 1.5rem;
            color: #6c757d;
            text-decoration: none;
            font-size: 0.9rem;
            transition: color 0.3s ease;
        }

        .back-link:hover {
            color: #805ad5;
        }

        .error-message {
            color: #e53e3e;
            font-size: 0.9rem;
            margin-top: 0.5rem;
            display: none;
        }

        .login-attempts {
            text-align: center;
            margin-top: 1rem;
            font-size: 0.85rem;
            color: #6c757d;
        }

        .lockout-message {
            color: #e53e3e;
            text-align: center;
            margin-top: 1rem;
            font-size: 0.9rem;
            display: none;
        }

        .password-requirements {
            margin-top: 0.5rem;
            font-size: 0.8rem;
            color: #6c757d;
        }

        .csrf-token {
            display: none;
        }
    </style>
</head>
<body>
    <div class="login-container">
        <div class="login-header">
            <h1>Admin Login</h1>
            <p>Enter your credentials to access the admin panel</p>
        </div>
        
        <form id="login-form">
            <!-- CSRF Token (hidden) -->
            <input type="hidden" id="csrf-token" class="csrf-token" value="">
            
            <div class="form-group">
                <label for="username">Username</label>
                <input type="text" id="username" name="username" autocomplete="username" required>
            </div>
            
            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" id="password" name="password" autocomplete="current-password" required>
                <div class="password-requirements">
                    For security reasons, use a strong password with letters, numbers, and special characters.
                </div>
            </div>
            
            <div id="error-message" class="error-message">
                Invalid username or password. Please try again.
            </div>
            
            <button type="submit" class="btn btn-primary">Login</button>
        </form>
        
        <div id="login-attempts" class="login-attempts">
            Remaining login attempts: <span id="attempts-count">5</span>
        </div>
        
        <div id="lockout-message" class="lockout-message">
            Too many failed login attempts. Please try again in <span id="lockout-timer">30</span> seconds.
        </div>
        
        <a href="index.html" class="back-link">Back to Main Page</a>
    </div>
    
    <script>
        // DOM Elements
        const loginForm = document.getElementById('login-form');
        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');
        const errorMessage = document.getElementById('error-message');
        const loginAttemptsDiv = document.getElementById('login-attempts');
        const attemptsCountSpan = document.getElementById('attempts-count');
        const lockoutMessageDiv = document.getElementById('lockout-message');
        const lockoutTimerSpan = document.getElementById('lockout-timer');
        const csrfTokenInput = document.getElementById('csrf-token');
        
        // Security Configuration
        const MAX_LOGIN_ATTEMPTS = 5;
        const LOCKOUT_TIME = 30; // seconds
        const CORRECT_USERNAME = 'admin';
        const CORRECT_PASSWORD = '123';
        
        // State Variables
        let loginAttempts = 0;
        let isLockedOut = false;
        let lockoutTimer = null;
        let lockoutTimeRemaining = LOCKOUT_TIME;
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Check if user is already authenticated
            if (isAuthenticated()) {
                redirectToAdmin();
                return;
            }
            
            // Generate CSRF token
            generateCSRFToken();
            
            // Check if user is locked out
            checkLockoutStatus();
            
            // Setup event listeners
            setupEventListeners();
        });
        
        // Setup Event Listeners
        function setupEventListeners() {
            loginForm.addEventListener('submit', handleLogin);
            
            // Add input sanitization
            usernameInput.addEventListener('input', sanitizeInput);
            passwordInput.addEventListener('input', sanitizeInput);
        }
        
        // Handle Login
        function handleLogin(e) {
            e.preventDefault();
            
            // Verify CSRF token
            if (!verifyCSRFToken()) {
                showError('Security validation failed. Please refresh the page and try again.');
                return;
            }
            
            // Check if user is locked out
            if (isLockedOut) {
                showError('Too many failed login attempts. Please try again later.');
                return;
            }
            
            // Get and sanitize input values
            const username = sanitizeString(usernameInput.value.trim());
            const password = sanitizeString(passwordInput.value);
            
            // Validate credentials
            if (validateCredentials(username, password)) {
                // Successful login
                createSecureSession();
                redirectToAdmin();
            } else {
                // Failed login
                handleFailedLogin();
            }
        }
        
        // Validate Credentials
        function validateCredentials(username, password) {
            // In a real application, this would involve server-side validation
            // and secure password hashing. For this demo, we use simple comparison.
            return username === CORRECT_USERNAME && password === CORRECT_PASSWORD;
        }
        
        // Handle Failed Login
        function handleFailedLogin() {
            loginAttempts++;
            
            // Update attempts counter
            attemptsCountSpan.textContent = MAX_LOGIN_ATTEMPTS - loginAttempts;
            
            // Show error message
            showError('Invalid username or password. Please try again.');
            
            // Check if max attempts reached
            if (loginAttempts >= MAX_LOGIN_ATTEMPTS) {
                lockAccount();
            }
            
            // Store attempts in localStorage
            localStorage.setItem('loginAttempts', loginAttempts);
            localStorage.setItem('lastAttemptTime', Date.now());
        }
        
        // Lock Account
        function lockAccount() {
            isLockedOut = true;
            lockoutTimeRemaining = LOCKOUT_TIME;
            
            // Hide login form elements
            loginForm.querySelector('button').disabled = true;
            loginAttemptsDiv.style.display = 'none';
            
            // Show lockout message
            lockoutMessageDiv.style.display = 'block';
            lockoutTimerSpan.textContent = lockoutTimeRemaining;
            
            // Start lockout timer
            lockoutTimer = setInterval(() => {
                lockoutTimeRemaining--;
                lockoutTimerSpan.textContent = lockoutTimeRemaining;
                
                if (lockoutTimeRemaining <= 0) {
                    unlockAccount();
                }
            }, 1000);
            
            // Store lockout info in localStorage
            localStorage.setItem('isLockedOut', 'true');
            localStorage.setItem('lockoutEndTime', Date.now() + (LOCKOUT_TIME * 1000));
        }
        
        // Unlock Account
        function unlockAccount() {
            isLockedOut = false;
            loginAttempts = 0;
            
            // Clear timer
            if (lockoutTimer) {
                clearInterval(lockoutTimer);
                lockoutTimer = null;
            }
            
            // Reset UI
            loginForm.querySelector('button').disabled = false;
            loginAttemptsDiv.style.display = 'block';
            lockoutMessageDiv.style.display = 'none';
            attemptsCountSpan.textContent = MAX_LOGIN_ATTEMPTS;
            
            // Clear error message
            errorMessage.style.display = 'none';
            
            // Clear lockout info from localStorage
            localStorage.removeItem('isLockedOut');
            localStorage.removeItem('lockoutEndTime');
            localStorage.removeItem('loginAttempts');
        }
        
        // Check Lockout Status
        function checkLockoutStatus() {
            const isLockedOutStored = localStorage.getItem('isLockedOut') === 'true';
            const lockoutEndTime = parseInt(localStorage.getItem('lockoutEndTime') || '0');
            const storedAttempts = parseInt(localStorage.getItem('loginAttempts') || '0');
            
            if (isLockedOutStored && lockoutEndTime > Date.now()) {
                // User is still locked out
                isLockedOut = true;
                loginAttempts = storedAttempts;
                
                // Calculate remaining time
                lockoutTimeRemaining = Math.ceil((lockoutEndTime - Date.now()) / 1000);
                
                // Update UI
                loginForm.querySelector('button').disabled = true;
                loginAttemptsDiv.style.display = 'none';
                lockoutMessageDiv.style.display = 'block';
                lockoutTimerSpan.textContent = lockoutTimeRemaining;
                
                // Start lockout timer
                lockoutTimer = setInterval(() => {
                    lockoutTimeRemaining--;
                    lockoutTimerSpan.textContent = lockoutTimeRemaining;
                    
                    if (lockoutTimeRemaining <= 0) {
                        unlockAccount();
                    }
                }, 1000);
            } else if (isLockedOutStored) {
                // Lockout period has expired
                unlockAccount();
            } else {
                // Not locked out, but may have previous attempts
                loginAttempts = storedAttempts;
                attemptsCountSpan.textContent = MAX_LOGIN_ATTEMPTS - loginAttempts;
            }
        }
        
        // Create Secure Session
        function createSecureSession() {
            // Generate a secure session token
            const sessionToken = generateSecureToken(64);
            
            // Set session expiration (30 minutes from now)
            const expirationTime = Date.now() + (30 * 60 * 1000);
            
            // Store session data
            const sessionData = {
                token: sessionToken,
                username: CORRECT_USERNAME,
                expires: expirationTime,
                userAgent: navigator.userAgent,
                created: Date.now()
            };
            
            // Store in localStorage (in a real app, this would be a secure HTTP-only cookie)
            localStorage.setItem('adminSession', JSON.stringify(sessionData));
        }
        
        // Check if User is Authenticated
        function isAuthenticated() {
            const sessionData = JSON.parse(localStorage.getItem('adminSession') || 'null');
            
            if (!sessionData) {
                return false;
            }
            
            // Check if session has expired
            if (sessionData.expires < Date.now()) {
                // Session expired, clear it
                localStorage.removeItem('adminSession');
                return false;
            }
            
            // Check if user agent matches (prevent session hijacking)
            if (sessionData.userAgent !== navigator.userAgent) {
                // Possible session hijacking attempt, clear session
                localStorage.removeItem('adminSession');
                return false;
            }
            
            return true;
        }
        
        // Redirect to Admin Panel
        function redirectToAdmin() {
            window.location.href = 'admin.html';
        }
        
        // Generate CSRF Token
        function generateCSRFToken() {
            const token = generateSecureToken(32);
            csrfTokenInput.value = token;
            
            // Store token in localStorage (in a real app, this would be stored server-side)
            localStorage.setItem('csrfToken', token);
        }
        
        // Verify CSRF Token
        function verifyCSRFToken() {
            const storedToken = localStorage.getItem('csrfToken');
            const formToken = csrfTokenInput.value;
            
            return storedToken && formToken && storedToken === formToken;
        }
        
        // Generate Secure Token
        function generateSecureToken(length) {
            const array = new Uint8Array(length);
            window.crypto.getRandomValues(array);
            
            return Array.from(array)
                .map(byte => byte.toString(16).padStart(2, '0'))
                .join('');
        }
        
        // Show Error Message
        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
        }
        
        // Sanitize Input (prevent XSS)
        function sanitizeInput(e) {
            e.target.value = sanitizeString(e.target.value);
        }
        
        // Sanitize String
        function sanitizeString(str) {
            // Replace potentially dangerous characters
            return str.replace(/[<>&"']/g, function(c) {
                return {
                    '<': '&lt;',
                    '>': '&gt;',
                    '&': '&amp;',
                    '"': '&quot;',
                    "'": '&#39;'
                }[c];
            });
        }
    </script>
</body>
</html>
